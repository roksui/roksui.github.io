---
title: "Introduction to Python Bytecode"
---

## 개요
파이썬으로 코딩을 하면 주로 `.py` 확장자의 소스 코드 파일들을 만들고 실행한다. 또한, 바이트코드인 `.pyc` 파일 또한 생성되는 것을 본적이 있을 것이다. (Python3 부터는 이 파일이 `.py` 파일과 같은 디렉토리가 아닌 `__pycache__` 서브디렉토리에 생성되긴 한다)

본 글에서는 바이트코드 파일 안에 어떠한 코드가 있고 Python이 이를 어떻게 실행하는지를 알아볼 것이다.

## How Python works
파이썬은 주로 interpreted 언어(프로그램이 실행되면서 소스 코드가 한줄 한줄 네이티브 CPU 명령어로 변환되는 언어)로 설명된다. 그러나 이는 부분적으로만 맞다. 파이썬은 먼저 가상 머신이 이해할 수 있는 명령어로 소스 코드를 컴파일한다 - 파이썬 Interpreter가 이러한 가상 머신의 구현체이다. 이렇게 컴파일된 것을 '바이트코드'라고 한다. 즉, `.pyc`파일은 우리의 프로그램이 실행되면서 파이썬의 가상 머신이 실행하게 될 바이트코드 명령어들이다.

예를 들어 클래식한 "Hello, World!" 예시를 보자.

```python
def hello():
    print("Hello, World!")
```

이는 다음과 같은 바이트코드로 변환된다 - 인간이 읽을 수 있는 형태로 보면 다음과 같다.

```
2        0 LOAD_GLOBAL         0 (print)
         2 LOAD_CONST          1 ('Hello, World!')
         4 CALL_FUNCTION       1
```

위의 `hello()` 함수를 작성하여 CPython 인터프리터를 통해 실행하면 Python이 실행하는 것은 위 바이트코드에 있는 명령어들이 실행되는 것이다.

## Inside the Python virtual machine
CPython은 Python 언어의 구현체이다. 여기서 주의해야 할 것이, Python은 프로그래밍 언어이고, 구현체라함은 컴파일러, 인터프리터 등이 된다.

CPython은 스택 기반의 가상 머신을 사용한다. 즉, 완전히 스택 데이터 구조를 사용하는 것이다. CPython은 세 가지 종류의 스택을 사용한다.

1. **Call Stack** - 실행되는 파이썬 프로그램의 주요 구조가 된다. 콜 스택은 현재 active한 각 함수 호출에 대해 하나의 아이템인 '프레임'을 가진다. 즉, 프로그램의 entry point는 스택의 가장 밑에 있게 된다. 함수 호출이 생길 때 마다, 새로운 프레임이 콜 스택에 들어가고, 함수가 리턴할 때 마다 프레임이 pop된다.

2. 각 프레임 안에는 **evaluation stack**(also called **data stack**)이라는 것이 있다. 이 스택은 파이썬 함수의 실행이 일어나는 공간이다. 파이썬 코드를 실행하는 것이라함은 주로 이 스택에 아이템들을 push하고, 조작하고 다시 pop off하는 것을 말한다.

3. 각 프레임 안에는 **block stack**이라는 것도 있다. 이 스택은 파이썬이 특정 제어 구조들을 추적하기 위해 사용된다 - 루프, try/except 블록, with 블록들은 블록 스택에 아이템은 push하게 하고

TBD...........